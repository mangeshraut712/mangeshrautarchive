name: ðŸš€ Deploy Portfolio with AI Integration

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    environment: production
    steps:
    - name: ðŸ“¥ Checkout repository
      uses: actions/checkout@v4

    - name: ðŸ”§ Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'

    - name: ðŸ“¦ Install dependencies
      run: npm ci

    - name: ðŸ”‘ Configure API Keys for Production
      run: |
        # Create production config with GitHub secrets
        cat > js/config.local.js << 'EOF'
        // ðŸš€ PRODUCTION CONFIGURATION - Generated by GitHub Actions
        // ðŸ” Using GitHub Repository Secrets
        export const localConfig = {
          // ðŸ”¥ Grok xAI - Latest AI Model
          grokEnabled: true,
          grokApiKey: "${{ secrets.GROK_API_KEY }}",

          // ðŸ¤– Claude (Anthropic) - Fallback AI
          anthropicEnabled: true,
          anthropicApiKey: "${{ secrets.ANTHROPIC_API_KEY }}",

          // ðŸ“š Other API configurations
          wikipediaEnabled: true,
          duckduckgoEnabled: true,
          stackoverflowEnabled: true,

          // ðŸ”§ MCP Server integrations
          mcpEnabled: true,
          perplexityEnabled: true,
          githubEnabled: true
        };
        EOF

        # Configure Perplexity MCP server
        cat > perplexity-mcp.json << 'EOF'
        {
          "mcpServers": {
            "pplx-server": {
              "command": "node",
              "args": ["/Users/mangeshraut/Documents/Cline/MCP/perplexity-server/build/index.js"],
              "env": {
                "PERPLEXITY_API_KEY": "${{ secrets.PERPLEXITY_API_KEY }}"
              }
            }
          }
        }
        EOF

    - name: ðŸ—ï¸ Build Portfolio
      run: npm run build
      env:
        NODE_ENV: production

    - name: ðŸš€ Deploy to GitHub Pages
      uses: peaceiris/actions-gh-pages@v3
      if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master'
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./dist
        cname: mangeshraut712.github.io
